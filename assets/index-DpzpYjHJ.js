var x=Object.defineProperty;var C=(s,e,t)=>e in s?x(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>C(s,typeof e!="symbol"?e+"":e,t);import{i as l,a as z}from"./index-DUa75n_-.js";import{P as B,c as y,C as D,a as E,b as _,I as A,B as G}from"./Popup.service-BPaXj_mL.js";const L=s=>{const e=Math.floor(Math.random()*s.length);return s[e]};class w extends B{constructor(e){const t=document.createElement("span");t.textContent=e;const r=y("/game","New Game"),i=y("/home","Exit to menu"),h=new D("div",{children:[i,r],classes:["btn-wrapper"]}).render();super({selector:"end-game-popup",children:[t,h]}),r.addEventListener("click",this.destroy.bind(this)),i.addEventListener("click",this.destroy.bind(this))}}class O{constructor(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}update(e,t){e.left&&this.x>0&&(this.x-=5),e.right&&this.x+this.width<t&&(this.x+=5)}draw(e){e.fillStyle="blue",e.fillRect(this.x,this.y,this.width,this.height)}}class T{constructor(e,t,r=10,i=4,h=4){this.x=e,this.y=t,this.radius=r,this.dx=i,this.dy=h}getPosition(e){const t=this[e];if(typeof t!="function")return t}updatePosition(){return this.x+=this.dx,this.y+=this.dy,this}performWallCollision(e,t,r){(e.x-e.radius<0||e.x+e.radius>t)&&(e.dx*=-1),e.y-e.radius<0&&(e.dy*=-1)}performBallCollision(e,t){return!t.isDestroyed&&e.x>t.x&&e.x<t.x+t.width&&e.y>t.y&&e.y<t.y+t.height?(e.dy*=-1,!0):!1}performPaddleCollision(e,t){e.y+e.radius>t.y&&e.x>t.x&&e.x<t.x+t.width&&(e.dy*=-1,e.y=t.y-e.radius)}draw(e){e.fillStyle="red",e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fill(),e.closePath()}}class p{constructor(e,t,r,i){n(this,"_isDestroyed",!1);this.x=e,this.y=t,this.width=r,this.height=i}get isDestroyed(){return this._isDestroyed}draw(e){this._isDestroyed||(e.fillStyle="green",e.fillRect(this.x,this.y,this.width,this.height))}destroy(){this._isDestroyed=!0}static createBricksField(e,t,r){const i=L(e),h=i[0].length,a=i.length,d=t/(h+2),f=r/20,u=d*.1,g=r*.1,S=(t-h*(d+u))/2,m=[];for(let o=0;o<a;o++)for(let c=0;c<h;c++)i[o][c]===1&&m.push(new p(S+c*(d+u),g+o*(f+u),d,f));return m}static isAllBricksDestroyed(e){return e.every(t=>t.isDestroyed)}}const k=800,H=600,I=[[[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1],[1,1,1,1,1,1,1,1]],[[1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1]],[[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1]],[[1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,0],[0,0,1,1,1,1,0,0]],[[1,0,1,0,1,0,1,0],[1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,0]],[[1,1,1,1,1,1,1,1],[1,1,0,0,0,0,1,1],[1,0,1,0,0,1,0,1]],[[1,1,1,1,1,1,1,1],[1,0,1,0,1,0,1,1],[0,1,0,1,0,1,0,1]],[[0,0,1,1,1,1,0,0],[0,1,0,0,0,0,1,0],[1,0,1,0,0,1,0,1]],[[1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1]],[[1,0,0,1,1,0,0,1],[0,1,1,0,0,1,1,0],[1,0,0,1,1,0,0,1]],[[0,1,0,1,0,1,0,1],[1,0,1,0,1,0,1,0],[0,1,0,1,0,1,0,1]]];var N=Object.getOwnPropertyDescriptor,R=(s,e,t,r)=>{for(var i=r>1?void 0:r?N(e,t):e,h=s.length-1,a;h>=0;h--)(a=s[h])&&(i=a(i)||i);return i};let v=class{constructor(){n(this,"canvasService",l.resolve(E));n(this,"popupService",l.resolve(_));n(this,"input",l.resolve(A));n(this,"canvasSizes",{width:window.innerWidth||k,height:window.innerHeight||H});n(this,"bricks",p.createBricksField(I,this.canvasSizes.width,this.canvasSizes.height));n(this,"ball",new T(this.canvasSizes.width/2,this.canvasSizes.height/2,this.canvasSizes.width*.015));n(this,"paddle",new O(this.canvasSizes.width/2-this.canvasSizes.width*.1,this.canvasSizes.height-this.canvasSizes.height*.05,this.canvasSizes.width*.2,this.canvasSizes.height*.02))}init(s){this.canvasService.build(s,{width:this.canvasSizes.width,height:this.canvasSizes.height,classes:["game-field"]}),this.gameLoop()}gameLoop(){this.update(),this.rerender(),!this.isGameOver()&&requestAnimationFrame(this.gameLoop.bind(this))}update(){this.paddle.update(this.input,this.canvasSizes.width),this.ball.updatePosition(),this.performBallCollisions(this.ball)}isGameOver(){if(this.isBallBelowPaddleOver())return this.popupService.open(w,"You lose :("),!0;if(p.isAllBricksDestroyed(this.bricks))return this.popupService.open(w,"You won!"),!0}isBallBelowPaddleOver(){const s=this.ball.getPosition("y");return s!=null&&s>this.canvasSizes.height}performBallCollisions(s){this.ball.performWallCollision(s,this.canvasSizes.width,this.canvasSizes.height),this.ball.performPaddleCollision(s,this.paddle),this.bricks.forEach(e=>{this.ball.performBallCollision(s,e)&&e.destroy()})}rerender(){this.canvasService.render(this.paddle,this.ball,...this.bricks)}};v=R([z()],v);class M extends G{constructor(){super("");n(this,"gameService",l.resolve(v));this.element=document.createElement("div"),this.gameService.init(this.element)}render(){return this.element}}export{M as GameComponent};
